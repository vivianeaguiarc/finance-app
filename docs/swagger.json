{
    "swagger": "2.0",
    "info": {
        "title": "Finance App API",
        "description": "API for Finance App that allows users to manage their finances.",
        "version": "1.0.0"
    },
    "schemes": ["http", "https"],
    "consumes": ["application/json"],
    "produces": ["application/json"],

    "securityDefinitions": {
        "BearerAuth": {
            "type": "apiKey",
            "name": "Authorization",
            "in": "header",
            "description": "Use this format: **Bearer <your_token>**"
        }
    },

    "paths": {
        "/api/users": {
            "post": {
                "summary": "Create a new user",
                "tags": ["User"],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "required": true,
                        "schema": { "$ref": "#/definitions/CreateUserParams" }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "User created successfully",
                        "schema": { "$ref": "#/definitions/UserWithToken" }
                    },
                    "400": {
                        "description": "Invalid params",
                        "schema": {
                            "$ref": "#/definitions/InvalidParamResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            }
        },

        "/api/users/login": {
            "post": {
                "summary": "Login user",
                "tags": ["User"],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "required": true,
                        "schema": { "$ref": "#/definitions/LoginUserParams" }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Login success",
                        "schema": { "$ref": "#/definitions/UserWithToken" }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/UnauthorizedErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            }
        },

        "/api/users/refresh-token": {
            "post": {
                "summary": "Refresh tokens",
                "tags": ["User"],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "required": true,
                        "schema": { "$ref": "#/definitions/RefreshTokenParams" }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Tokens refreshed successfully",
                        "schema": { "$ref": "#/definitions/Tokens" }
                    },
                    "401": {
                        "description": "Invalid token",
                        "schema": {
                            "$ref": "#/definitions/UnauthorizedErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            }
        },

        "/api/users/me": {
            "get": {
                "summary": "Get authenticated user",
                "tags": ["User"],
                "security": [{ "BearerAuth": [] }],
                "responses": {
                    "200": {
                        "description": "User found",
                        "schema": { "$ref": "#/definitions/User" }
                    },
                    "404": {
                        "description": "User not found",
                        "schema": {
                            "$ref": "#/definitions/UserNotFoundResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            },
            "patch": {
                "summary": "Update authenticated user",
                "tags": ["User"],
                "security": [{ "BearerAuth": [] }],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "required": true,
                        "schema": { "$ref": "#/definitions/UpdateUserParams" }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User updated",
                        "schema": { "$ref": "#/definitions/User" }
                    },
                    "400": {
                        "description": "Invalid params",
                        "schema": {
                            "$ref": "#/definitions/InvalidParamResponse"
                        }
                    },
                    "404": {
                        "description": "User not found",
                        "schema": {
                            "$ref": "#/definitions/UserNotFoundResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            },
            "delete": {
                "summary": "Delete authenticated user",
                "tags": ["User"],
                "security": [{ "BearerAuth": [] }],
                "responses": {
                    "200": {
                        "description": "User deleted",
                        "schema": { "$ref": "#/definitions/User" }
                    },
                    "404": {
                        "description": "User not found",
                        "schema": {
                            "$ref": "#/definitions/UserNotFoundResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            }
        },

        "/api/users/me/balance": {
            "get": {
                "summary": "Get authenticated user balance",
                "tags": ["User"],
                "security": [{ "BearerAuth": [] }],
                "parameters": [
                    {
                        "in": "query",
                        "name": "from",
                        "required": true,
                        "type": "string",
                        "format": "date"
                    },
                    {
                        "in": "query",
                        "name": "to",
                        "required": true,
                        "type": "string",
                        "format": "date"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Balance data",
                        "schema": { "$ref": "#/definitions/UserBalance" }
                    },
                    "404": {
                        "description": "User not found",
                        "schema": {
                            "$ref": "#/definitions/UserNotFoundResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            }
        },

        "/api/transactions/me": {
            "get": {
                "summary": "Get authenticated user transactions",
                "tags": ["Transaction"],
                "security": [{ "BearerAuth": [] }],
                "parameters": [
                    {
                        "name": "from",
                        "in": "query",
                        "required": true,
                        "type": "string",
                        "format": "date"
                    },
                    {
                        "name": "to",
                        "in": "query",
                        "required": true,
                        "type": "string",
                        "format": "date"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Transactions list",
                        "schema": {
                            "type": "array",
                            "items": { "$ref": "#/definitions/Transaction" }
                        }
                    },
                    "404": {
                        "description": "User not found",
                        "schema": {
                            "$ref": "#/definitions/UserNotFoundResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            },
            "post": {
                "summary": "Create transaction",
                "tags": ["Transaction"],
                "security": [{ "BearerAuth": [] }],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/CreateTransactionParams"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Transaction created",
                        "schema": { "$ref": "#/definitions/Transaction" }
                    },
                    "400": {
                        "description": "Invalid params",
                        "schema": {
                            "$ref": "#/definitions/InvalidParamResponse"
                        }
                    },
                    "404": {
                        "description": "User not found",
                        "schema": {
                            "$ref": "#/definitions/UserNotFoundResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/InternalServerErrorResponse"
                        }
                    }
                }
            }
        }
    },

    "definitions": {
        "User": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string",
                    "example": "e29ef739-ffae-45a8-a582-fb56f9660a12"
                },
                "first_name": { "type": "string", "example": "John" },
                "last_name": { "type": "string", "example": "Doe" },
                "email": { "type": "string", "example": "john@doe.com" }
            }
        },

        "UserWithToken": {
            "allOf": [
                { "$ref": "#/definitions/User" },
                {
                    "type": "object",
                    "properties": {
                        "tokens": {
                            "type": "object",
                            "properties": {
                                "accessToken": {
                                    "type": "string",
                                    "example": "eyJh..."
                                },
                                "refreshToken": {
                                    "type": "string",
                                    "example": "dGhp..."
                                }
                            }
                        }
                    }
                }
            ]
        },

        "Tokens": {
            "type": "object",
            "properties": {
                "accessToken": { "type": "string" },
                "refreshToken": { "type": "string" }
            }
        },

        "CreateUserParams": {
            "type": "object",
            "required": ["first_name", "last_name", "email", "password"],
            "properties": {
                "first_name": { "type": "string" },
                "last_name": { "type": "string" },
                "email": { "type": "string" },
                "password": { "type": "string" }
            }
        },

        "LoginUserParams": {
            "type": "object",
            "required": ["email", "password"],
            "properties": {
                "email": { "type": "string" },
                "password": { "type": "string" }
            }
        },

        "RefreshTokenParams": {
            "type": "object",
            "required": ["refreshToken"],
            "properties": {
                "refreshToken": { "type": "string" }
            }
        },

        "UserBalance": {
            "type": "object",
            "properties": {
                "earnings": { "type": "string" },
                "expenses": { "type": "string" },
                "investments": { "type": "string" },
                "earningsPercentage": { "type": "string" },
                "expensesPercentage": { "type": "string" },
                "investmentsPercentage": { "type": "string" },
                "balance": { "type": "string" }
            }
        },

        "Transaction": {
            "type": "object",
            "properties": {
                "id": { "type": "string" },
                "user_id": { "type": "string" },
                "name": { "type": "string" },
                "type": { "type": "string" },
                "amount": { "type": "number" },
                "date": { "type": "string" }
            }
        },

        "CreateTransactionParams": {
            "type": "object",
            "required": ["name", "type", "amount", "date"],
            "properties": {
                "name": { "type": "string" },
                "type": { "type": "string" },
                "date": { "type": "string" },
                "amount": { "type": "number" }
            }
        },

        "UpdateTransactionParams": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "type": { "type": "string" },
                "date": { "type": "string" },
                "amount": { "type": "number" }
            }
        },

        "UserNotFoundResponse": {
            "type": "object",
            "properties": {
                "message": { "type": "string", "example": "User not found" }
            }
        },

        "TransactionNotFoundResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string",
                    "example": "Transaction not found"
                }
            }
        },

        "InvalidParamResponse": {
            "type": "object",
            "properties": {
                "message": { "type": "string" }
            }
        },

        "UnauthorizedErrorResponse": {
            "type": "object",
            "properties": {
                "message": { "type": "string", "example": "Unauthorized" }
            }
        },

        "InternalServerErrorResponse": {
            "type": "object",
            "properties": {
                "message": { "type": "string" }
            }
        }
    }
}
